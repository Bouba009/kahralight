<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KahraLight Store</title>
    <!-- خط كايرو وتجزئة الأيقونات -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-blue: #0044cc; /* Kahra */
            --primary-orange: #ff9900; /* Light */
            --canary-yellow: #fff700;
            --bg-light: #f8f9fa;
            --white: #ffffff;
            --text-dark: #1a1a1a;
            --text-gray: #666;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --radius: 12px;
        }

        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body { background-color: var(--bg-light); color: var(--text-dark); padding-bottom: 60px; }
        a { text-decoration: none; color: inherit; }
        ul { list-style: none; }
        img { max-width: 100%; display: block; }

        /* --- Header (Shopify Style) --- */
        header {
            background: var(--white);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo { font-size: 24px; font-weight: 800; letter-spacing: -0.5px; }
        .logo-kahra { color: var(--primary-blue); }
        .logo-light { color: var(--primary-orange); text-shadow: 0 0 15px rgba(255, 153, 0, 0.4); }

        .search-wrapper {
            flex: 1; margin: 0 20px; position: relative; display: none; /* Hidden on mobile initially */
        }
        @media(min-width: 768px) { .search-wrapper { display: block; } }

        .search-input {
            width: 100%; padding: 12px 40px 12px 15px;
            background: #f1f1f1; border: none; border-radius: 8px; font-size: 14px;
        }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #999; }

        .nav-icons { display: flex; gap: 15px; align-items: center; }
        .icon-btn { font-size: 1.3rem; color: #333; position: relative; cursor: pointer; }
        .badge { position: absolute; top: -5px; right: -5px; background: var(--primary-orange); color: #fff; font-size: 10px; padding: 2px 6px; border-radius: 10px; font-weight: bold; }

        /* --- Mobile Search --- */
        .mobile-search { padding: 10px; background: white; display: block; border-bottom: 1px solid #eee; }
        @media(min-width: 768px) { .mobile-search { display: none; } }

        /* --- Slider --- */
        .slider-container { width: 100%; height: 200px; position: relative; overflow: hidden; }
        @media(min-width: 768px) { .slider-container { height: 400px; } }
        .slide { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; opacity: 0; transition: opacity 1s ease-in-out; }
        .slide.active { opacity: 1; }

        /* --- Ticker (Yellow Bar) --- */
        .ticker-wrap {
            width: 100%; background: var(--canary-yellow); height: 40px; overflow: hidden; position: relative;
            display: flex; align-items: center; border-bottom: 1px solid #e6de00;
        }
        .ticker {
            white-space: nowrap; font-weight: 700; font-size: 14px; color: #000; position: absolute;
            will-change: transform;
        }
        /* Animation will be injected by JS */

        /* --- Sidebar --- */
        .sidebar {
            position: fixed; top: 0; right: -280px; width: 280px; height: 100%;
            background: var(--white); z-index: 2000; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: -5px 0 15px rgba(0,0,0,0.1); padding: 20px; display: flex; flex-direction: column;
        }
        .sidebar.active { right: 0; }
        .sidebar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .sidebar-header h3 { font-weight: 700; color: var(--primary-blue); }
        .cat-item {
            padding: 15px 10px; border-bottom: 1px solid #f0f0f0; cursor: pointer; font-weight: 600;
            display: flex; justify-content: space-between; color: #444; transition: 0.2s;
        }
        .cat-item:hover { color: var(--primary-blue); padding-right: 15px; }
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);
            z-index: 1500; display: none; backdrop-filter: blur(2px);
        }
        .overlay.active { display: block; }

        /* --- Products Grid (Shopify Style) --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px 15px; }
        .section-title { font-size: 20px; font-weight: 700; margin-bottom: 20px; color: #111; }

        .grid {
            display: grid; 
            grid-template-columns: repeat(2, 1fr); /* 2 columns on mobile */
            gap: 15px;
        }
        @media(min-width: 768px) { 
            .grid { grid-template-columns: repeat(4, 1fr); gap: 25px; } 
        }

        .product-card {
            background: var(--white); border-radius: var(--radius); overflow: hidden;
            transition: all 0.3s ease; position: relative; cursor: pointer;
            border: 1px solid #eee;
        }
        .product-card:hover { transform: translateY(-5px); box-shadow: var(--shadow); border-color: transparent; }
        
        .p-img-box { width: 100%; padding-top: 100%; /* 1:1 Aspect Ratio */ position: relative; background: #f9f9f9; }
        .p-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain; padding: 10px; transition: transform 0.3s; }
        .product-card:hover .p-img { transform: scale(1.05); }
        
        .p-details { padding: 12px; }
        .p-cat { font-size: 11px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; }
        .p-title { font-size: 14px; font-weight: 600; margin: 5px 0; color: #222; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .p-price-row { display: flex; align-items: center; gap: 8px; margin-top: 5px; }
        .p-price { font-weight: 700; color: var(--primary-blue); font-size: 15px; }
        .p-old-price { font-size: 12px; text-decoration: line-through; color: #aaa; }
        
        .btn-quick-add {
            width: 100%; background: var(--text-dark); color: #fff; border: none; padding: 10px;
            font-size: 13px; font-weight: 600; border-radius: 6px; margin-top: 10px; cursor: pointer;
        }
        .btn-quick-add:active { transform: scale(0.98); }

        /* --- Product Modal (Full Screen on Mobile) --- */
        .modal {
            display: none; position: fixed; z-index: 3000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); overflow-y: auto;
        }
        .modal-box {
            background-color: #fff; margin: 2% auto; padding: 0; width: 95%; max-width: 900px;
            border-radius: var(--radius); position: relative; display: flex; flex-direction: column; overflow: hidden;
        }
        @media(min-width: 768px) { .modal-box { flex-direction: row; margin: 5% auto; height: auto; } }

        .modal-close { position: absolute; top: 15px; left: 15px; background: #eee; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 10; font-size: 18px; }

        .m-img-col { background: #f4f4f4; flex: 1; display: flex; align-items: center; justify-content: center; min-height: 300px; }
        .m-img-col img { max-height: 400px; width: auto; mix-blend-mode: multiply; }
        
        .m-info-col { flex: 1; padding: 25px; display: flex; flex-direction: column; justify-content: center; }
        .m-title { font-size: 22px; font-weight: 800; margin-bottom: 10px; }
        .m-desc { font-size: 14px; color: #555; line-height: 1.6; margin-bottom: 20px; }
        
        .action-row { display: flex; gap: 10px; margin-top: 20px; }
        .qty-input { width: 60px; padding: 12px; border: 1px solid #ddd; border-radius: 6px; text-align: center; font-weight: bold; }
        
        .btn-buy { flex: 1; background: var(--primary-orange); color: #000; border: none; padding: 14px; font-weight: 700; border-radius: 6px; cursor: pointer; font-size: 16px; box-shadow: 0 4px 10px rgba(255,153,0,0.3); }

        /* --- Admin Login Modal --- */
        .login-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff;
            z-index: 4000; display: none; justify-content: center; align-items: center; flex-direction: column;
        }
        .login-box { text-align: center; width: 90%; max-width: 350px; }
        .login-input { width: 100%; padding: 15px; border: 2px solid #eee; border-radius: 8px; margin-bottom: 15px; font-size: 16px; transition: 0.3s; }
        .login-input:focus { border-color: var(--primary-blue); }
        .btn-login { width: 100%; padding: 15px; background: var(--primary-blue); color: #fff; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; cursor: pointer; }

        /* --- Admin Panel --- */
        #admin-panel { display: none; min-height: 100vh; background: #f0f2f5; padding-bottom: 50px; }
        .admin-header { background: #1a1a1a; color: #fff; padding: 20px; display: flex; justify-content: space-between; }
        .admin-container { padding: 20px; }
        .stat-card { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 15px; text-align: center; }
        .stat-num { font-size: 2rem; font-weight: bold; color: var(--primary-blue); }
        
        .admin-nav { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; margin-bottom: 20px; }
        .admin-nav button { white-space: nowrap; padding: 10px 20px; background: #fff; border: 1px solid #ddd; border-radius: 20px; cursor: pointer; }
        .admin-nav button.active { background: var(--primary-blue); color: #fff; border-color: var(--primary-blue); }

        /* Forms in Admin */
        .admin-form input, .admin-form textarea, .admin-form select { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 6px; }

        /* --- Footer --- */
        footer { background: #111; color: #ccc; padding: 40px 20px; font-size: 14px; margin-top: 40px; }
        footer h4 { color: #fff; margin-bottom: 15px; font-size: 16px; }
        footer input, footer textarea { background: #333; border: none; color: #fff; }

    </style>
</head>
<body>

    <!-- Overlay for Sidebar -->
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <!-- Header -->
    <header>
        <div class="icon-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
        
        <div class="logo">
            <span class="logo-kahra">Kahra</span><span class="logo-light">Light</span>
        </div>

        <div class="search-wrapper">
            <input type="text" class="search-input" id="desktopSearch" placeholder="بحث عن منتج..." onkeyup="searchProduct(this.value)">
            <i class="fas fa-search search-icon"></i>
        </div>

        <div class="nav-icons">
            <div class="icon-btn" onclick="toggleAdmin()"><i class="fas fa-user-circle"></i></div>
            <div class="icon-btn">
                <i class="fas fa-shopping-bag"></i>
                <span class="badge" id="cartCount">0</span>
            </div>
        </div>
    </header>

    <!-- Mobile Search -->
    <div class="mobile-search">
        <input type="text" class="search-input" placeholder="بحث..." onkeyup="searchProduct(this.value)">
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3>التصنيفات</h3>
            <div onclick="toggleSidebar()" style="cursor:pointer; font-size:20px;">&times;</div>
        </div>
        <ul id="category-list">
            <!-- Categories Injected Here -->
        </ul>
    </div>

    <!-- Main Content -->
    <div id="app-container">
        
        <!-- Slider -->
        <div class="slider-container" id="hero-slider">
            <!-- Images Injected JS -->
        </div>

        <!-- Ticker -->
        <div class="ticker-wrap">
            <div class="ticker" id="news-ticker">
                ⚡ شحن مجاني للطلبات فوق 5000 د.ج • تخفيضات 20% على الثريات • ضمان لمدة سنة على جميع المنتجات ⚡
            </div>
        </div>

        <!-- Products -->
        <div class="container">
            <h2 class="section-title">أحدث المنتجات</h2>
            <div class="grid" id="products-grid">
                <!-- Products Cards Here -->
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px;">
                <div>
                    <h4>اتصل بنا</h4>
                    <p>الجزائر العاصمة</p>
                    <p>0550-12-34-56</p>
                </div>
                <div>
                    <h4>ابلاغ عن مشكلة</h4>
                    <form onsubmit="event.preventDefault(); alert('تم استلام رسالتك');">
                        <input type="text" placeholder="الاسم" style="width:100%; padding:8px; margin-bottom:5px;">
                        <input type="email" placeholder="البريد" style="width:100%; padding:8px; margin-bottom:5px;">
                        <textarea placeholder="الرسالة" style="width:100%; padding:8px; margin-bottom:5px;"></textarea>
                        <button style="width:100%; padding:8px; background:var(--primary-orange); border:none; cursor:pointer;">ارسال</button>
                    </form>
                </div>
                <div>
                    <h4>روابط</h4>
                    <p>سياسة الخصوصية</p>
                    <p>من نحن</p>
                </div>
            </div>
            <div style="text-align:center; margin-top:30px; padding-top:20px; border-top:1px solid #333;">
                &copy; 2024 KahraLight Store
            </div>
        </footer>
    </div>

    <!-- Product Modal -->
    <div id="product-modal" class="modal">
        <div class="modal-box">
            <div class="modal-close" onclick="closeModal()">&times;</div>
            <div class="m-img-col">
                <img id="m-img" src="" alt="Product">
            </div>
            <div class="m-info-col">
                <div style="font-size:12px; color:var(--primary-blue); margin-bottom:5px;">KahraLight Official</div>
                <h1 id="m-title" class="m-title">اسم المنتج</h1>
                <div id="m-price" style="font-size:24px; font-weight:bold; color:var(--primary-orange); margin-bottom:15px;"></div>
                <p id="m-desc" class="m-desc">وصف...</p>
                
                <!-- Extra Links -->
                <div style="margin-bottom:20px; font-size:13px;">
                    <i class="fas fa-file-pdf"></i> <a href="#" style="text-decoration:underline;">تحميل fiche technique</a>
                </div>

                <!-- Order Form inside Modal for better UX -->
                <div style="background:#f9f9f9; padding:15px; border-radius:8px;">
                    <div style="display:flex; gap:10px; margin-bottom:10px;">
                        <div style="flex:1;">
                            <label style="font-size:12px; font-weight:bold;">اللون</label>
                            <select id="order-color" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;"></select>
                        </div>
                        <div>
                            <label style="font-size:12px; font-weight:bold;">الكمية</label>
                            <input type="number" id="order-qty" value="1" min="1" class="qty-input">
                        </div>
                    </div>

                    <h4 style="margin:10px 0; font-size:14px;">معلومات التوصيل:</h4>
                    <input type="text" id="cust-name" placeholder="الاسم الكامل" style="width:100%; padding:10px; margin-bottom:8px; border:1px solid #ddd; border-radius:6px;">
                    <input type="tel" id="cust-phone" placeholder="رقم الهاتف" style="width:100%; padding:10px; margin-bottom:8px; border:1px solid #ddd; border-radius:6px;">
                    <select id="cust-country" style="width:100%; padding:10px; margin-bottom:8px; border:1px solid #ddd; border-radius:6px;">
                        <option value="الجزائر">الجزائر</option>
                        <option value="اسبانيا">اسبانيا</option>
                        <option value="فرنسا">فرنسا</option>
                        <option value="البرتغال">البرتغال</option>
                    </select>
                    <textarea id="cust-address" placeholder="العنوان بالتفصيل" style="width:100%; padding:10px; margin-bottom:8px; border:1px solid #ddd; border-radius:6px; height:60px;"></textarea>
                    
                    <button class="btn-buy" onclick="submitOrder()">تأكيد الطلب</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Login Overlay -->
    <div id="login-modal" class="login-modal">
        <div class="login-box">
            <h2 style="margin-bottom:20px; color:var(--primary-blue);">دخول المدير</h2>
            <input type="text" id="admin-user" placeholder="اسم المستخدم" class="login-input">
            <input type="password" id="admin-pass" placeholder="كلمة المرور" class="login-input">
            <button class="btn-login" onclick="checkLogin()">دخول</button>
            <p id="login-error" style="color:red; margin-top:10px; display:none;">خطأ في البيانات!</p>
            <button onclick="document.getElementById('login-modal').style.display='none'" style="margin-top:10px; background:none; border:none; text-decoration:underline;">الرجوع للمتجر</button>
        </div>
    </div>

    <!-- Admin Panel Interface -->
    <div id="admin-panel">
        <div class="admin-header">
            <h3>لوحة التحكم</h3>
            <button onclick="logoutAdmin()" style="background:red; color:#fff; border:none; padding:5px 15px; border-radius:5px;">خروج</button>
        </div>
        <div class="admin-container">
            <div class="admin-nav">
                <button class="active" onclick="switchTab('dashboard')">الرئيسية</button>
                <button onclick="switchTab('products')">المنتجات</button>
                <button onclick="switchTab('orders')">الطلبات</button>
                <button onclick="switchTab('settings')">الإعدادات</button>
            </div>

            <!-- Dashboard -->
            <div id="tab-dashboard" class="tab-content">
                <div style="display:grid; grid-template-columns: repeat(2, 1fr); gap:15px;">
                    <div class="stat-card">
                        <div class="stat-num" id="stat-views">1.2K</div>
                        <div>زيارات</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-num" id="stat-orders">0</div>
                        <div>طلبات</div>
                    </div>
                </div>
            </div>

            <!-- Products Add -->
            <div id="tab-products" class="tab-content" style="display:none;">
                <div class="admin-form" style="background:#fff; padding:20px; border-radius:10px;">
                    <h4>إضافة منتج جديد</h4>
                    <input id="new-p-name" type="text" placeholder="اسم المنتج">
                    <input id="new-p-price" type="number" placeholder="السعر">
                    <input id="new-p-cat" type="text" placeholder="الفئة (مثال: انارة)">
                    <input id="new-p-img" type="text" placeholder="رابط الصورة">
                    <textarea id="new-p-desc" placeholder="الوصف"></textarea>
                    <button onclick="addProduct()" style="width:100%; background:green; color:#fff; padding:10px; border:none; border-radius:5px;">حفظ</button>
                </div>
            </div>

            <!-- Orders Table -->
            <div id="tab-orders" class="tab-content" style="display:none;">
                <div style="background:#fff; padding:10px; border-radius:10px; overflow-x:auto;">
                    <table style="width:100%; border-collapse:collapse; min-width:500px;">
                        <thead style="background:#eee;">
                            <tr>
                                <th style="padding:10px; text-align:right;">العميل</th>
                                <th style="padding:10px; text-align:right;">المنتج</th>
                                <th style="padding:10px; text-align:right;">السعر</th>
                            </tr>
                        </thead>
                        <tbody id="orders-list-body"></tbody>
                    </table>
                </div>
            </div>
            
             <!-- Settings -->
             <div id="tab-settings" class="tab-content" style="display:none;">
                <div class="admin-form" style="background:#fff; padding:20px; border-radius:10px;">
                    <h4>تعديل الشريط المتحرك</h4>
                    <input type="text" id="ticker-input" placeholder="النص الجديد">
                    <button onclick="updateTickerText()" style="width:100%; background:var(--primary-blue); color:#fff; padding:10px; border:none; border-radius:5px;">تحديث</button>
                </div>
            </div>

        </div>
    </div>

    <!-- JS Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Config
        const firebaseConfig = {
          apiKey: "AIzaSyC5dRvQZE1kMSsYojrMiyuQurnQwEleo3o",
          projectId: "mourafik-e9161", // Using your ID
          appId: "1:133465287328:web:9de5b3bd709099d885b7c5"
        };
        
        // Init (Try/Catch to avoid blocking if firebase fails due to bad config)
        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
        } catch(e) { console.log("Firebase Init Error (Local mode active)"); }

        // --- Data ---
        let products = [
            { id: 1, name: 'مصباح ذكي LED', price: 1500, old: 2000, cat: 'انارة', img: 'https://img.freepik.com/free-photo/glowing-light-bulb-dark-background_53876-104639.jpg?w=740', desc: 'تحكم بالهاتف', colors: ['أبيض'] },
            { id: 2, name: 'ثريا كريستال', price: 18000, old: 22000, cat: 'ديكور', img: 'https://img.freepik.com/free-photo/expensive-ceiling-chandelier_157027-3965.jpg?w=740', desc: 'للمنازل الفخمة', colors: ['ذهبي', 'فضي'] },
            { id: 3, name: 'مقبس كهربائي', price: 450, old: null, cat: 'كهرباء', img: 'https://img.freepik.com/free-photo/white-electric-switch_1122-3023.jpg?w=740', desc: 'آمن وعصري', colors: ['أبيض', 'رمادي'] },
            { id: 4, name: 'كابل نحاسي 50م', price: 3000, old: 3500, cat: 'كابلات', img: 'https://img.freepik.com/free-photo/electrical-wire-background_1409-3221.jpg?w=740', desc: 'جودة عالية', colors: ['أسود'] },
        ];
        let orders = [];
        let isAdmin = false;

        // --- Functions Exposed to Window ---
        window.toggleSidebar = () => {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
        };

        window.toggleAdmin = () => {
            if(isAdmin) {
                document.getElementById('app-container').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                renderOrdersAdmin();
            } else {
                document.getElementById('login-modal').style.display = 'flex';
            }
        };

        window.checkLogin = () => {
            const u = document.getElementById('admin-user').value;
            const p = document.getElementById('admin-pass').value;
            if(u === 'admin' && p === 'abobob123') {
                isAdmin = true;
                document.getElementById('login-modal').style.display = 'none';
                toggleAdmin();
            } else {
                document.getElementById('login-error').style.display = 'block';
            }
        };

        window.logoutAdmin = () => {
            isAdmin = false;
            document.getElementById('admin-panel').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
        };

        window.switchTab = (tab) => {
            document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.admin-nav button').forEach(b => b.classList.remove('active'));
            document.getElementById('tab-'+tab).style.display = 'block';
            event.target.classList.add('active');
        };

        // --- Rendering ---
        window.renderProducts = (list = products) => {
            const grid = document.getElementById('products-grid');
            grid.innerHTML = '';
            list.forEach(p => {
                const oldPriceHtml = p.old ? `<span class="p-old-price">${p.old} د.ج</span>` : '';
                grid.innerHTML += `
                    <div class="product-card" onclick="openModal(${p.id})">
                        <div class="p-img-box"><img src="${p.img}" class="p-img" loading="lazy"></div>
                        <div class="p-details">
                            <div class="p-cat">${p.cat}</div>
                            <div class="p-title">${p.name}</div>
                            <div class="p-price-row">
                                <span class="p-price">${p.price} د.ج</span>
                                ${oldPriceHtml}
                            </div>
                            <button class="btn-quick-add">عرض التفاصيل</button>
                        </div>
                    </div>
                `;
            });
        };

        window.renderCats = () => {
            const cats = [...new Set(products.map(p => p.cat))];
            const ul = document.getElementById('category-list');
            ul.innerHTML = `<li class="cat-item" onclick="filter('all'); toggleSidebar()">الكل <i class="fas fa-chevron-left"></i></li>`;
            cats.forEach(c => {
                ul.innerHTML += `<li class="cat-item" onclick="filter('${c}'); toggleSidebar()">${c} <i class="fas fa-chevron-left"></i></li>`;
            });
        };

        window.filter = (cat) => {
            if(cat === 'all') renderProducts(products);
            else renderProducts(products.filter(p => p.cat === cat));
        };

        window.searchProduct = (q) => {
            const filtered = products.filter(p => p.name.includes(q));
            renderProducts(filtered);
        };

        // --- Modal & Order ---
        let currentProd = null;
        window.openModal = (id) => {
            currentProd = products.find(p => p.id === id);
            document.getElementById('m-img').src = currentProd.img;
            document.getElementById('m-title').innerText = currentProd.name;
            document.getElementById('m-price').innerText = currentProd.price + ' د.ج';
            document.getElementById('m-desc').innerText = currentProd.desc;
            
            const sel = document.getElementById('order-color');
            sel.innerHTML = '';
            currentProd.colors.forEach(c => sel.innerHTML += `<option>${c}</option>`);
            
            document.getElementById('product-modal').style.display = 'block';
        };

        window.closeModal = () => document.getElementById('product-modal').style.display = 'none';

        window.submitOrder = async () => {
            const order = {
                prod: currentProd.name,
                price: currentProd.price,
                qty: document.getElementById('order-qty').value,
                cust: document.getElementById('cust-name').value,
                phone: document.getElementById('cust-phone').value,
                addr: document.getElementById('cust-address').value,
                date: new Date().toLocaleString()
            };

            if(!order.cust || !order.phone) { alert('يرجى ملء الاسم والهاتف'); return; }

            // Local save
            orders.unshift(order);
            document.getElementById('stat-orders').innerText = orders.length;

            // Animation
            const btn = document.querySelector('.btn-buy');
            btn.innerHTML = '<i class="fas fa-check"></i> تم الطلب!';
            btn.style.background = '#4CAF50';
            btn.style.color = '#fff';

            // Firebase save
            if(db) {
                try { await addDoc(collection(db, "orders"), order); } catch(e){}
            }

            setTimeout(() => {
                closeModal();
                btn.innerHTML = 'تأكيد الطلب';
                btn.style.background = 'var(--primary-orange)';
                btn.style.color = '#000';
            }, 2000);
        };

        // --- Admin Functions ---
        window.renderOrdersAdmin = () => {
            const tbody = document.getElementById('orders-list-body');
            tbody.innerHTML = '';
            orders.forEach(o => {
                tbody.innerHTML += `
                    <tr style="border-bottom:1px solid #ddd;">
                        <td style="padding:10px;">${o.cust}<br><small>${o.phone}</small></td>
                        <td style="padding:10px;">${o.prod} (x${o.qty})</td>
                        <td style="padding:10px; font-weight:bold;">${o.price * o.qty}</td>
                    </tr>
                `;
            });
        };

        window.addProduct = () => {
            const p = {
                id: Date.now(),
                name: document.getElementById('new-p-name').value,
                price: document.getElementById('new-p-price').value,
                cat: document.getElementById('new-p-cat').value,
                img: document.getElementById('new-p-img').value || 'https://via.placeholder.com/300',
                desc: document.getElementById('new-p-desc').value,
                colors: []
            };
            products.push(p);
            alert('تمت الاضافة');
            renderProducts();
            renderCats();
        };

        window.updateTickerText = () => {
            const t = document.getElementById('ticker-input').value;
            if(t) document.getElementById('news-ticker').innerText = t;
            alert('تم التحديث');
        };

        // --- Init Ticker Animation & Slider ---
        window.onload = () => {
            renderProducts();
            renderCats();

            // Slider Logic
            const imgs = [
                'https://cdn.shopify.com/s/files/1/0070/7032/files/lighting-banner.jpg?v=1588622765', // Example banner
                'https://cdn.shopify.com/s/files/1/0070/7032/files/banner-2.jpg?v=1588622765'
            ];
            const slider = document.getElementById('hero-slider');
            imgs.forEach((src, i) => {
                const img = document.createElement('img');
                img.className = i===0 ? 'slide active' : 'slide';
                img.src = src;
                slider.appendChild(img);
            });
            let sIdx = 0;
            setInterval(() => {
                document.querySelectorAll('.slide')[sIdx].classList.remove('active');
                sIdx = (sIdx+1)%imgs.length;
                document.querySelectorAll('.slide')[sIdx].classList.add('active');
            }, 4000);

            // Ticker Animation Injection (Left to Right for Arabic as requested)
            const style = document.createElement('style');
            style.innerHTML = `
                @keyframes tickerMove {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(100%); }
                }
                .ticker { animation: tickerMove 15s linear infinite; left: 0; min-width: 100%; }
            `;
            document.head.appendChild(style);
        };
    </script>
</body>
</html>
