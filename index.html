<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KahraLight Store</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #0044cc;
            --secondary: #ff9900;
            --bg-body: #f8f9fa;
            --bg-card: #ffffff;
            --text-main: #1a1a1a;
            --text-sub: #666666;
            --ticker-bg: #fff700;
            --shadow: 0 4px 20px rgba(0,0,0,0.06);
            --radius: 12px;
        }

        /* Themes */
        body.theme-dark-blue { --bg-body: #0f172a; --bg-card: #1e293b; --text-main: #fff; --text-sub: #cbd5e1; --primary: #3b82f6; }
        body.theme-orange-blue { --primary: #ff9900; --secondary: #0044cc; }
        body.theme-yellow-white { --bg-body: #fff; --primary: #ffd700; --secondary: #000; --text-main: #000; }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; font-family: 'Cairo', 'Roboto', sans-serif; }
        body { background-color: var(--bg-body); color: var(--text-main); transition: 0.3s; padding-bottom: 0; }
        a { text-decoration: none; color: inherit; }
        ul { list-style: none; }
        img { max-width: 100%; display: block; }

        /* --- Header --- */
        header { background: var(--bg-card); padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 900; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .logo { font-size: 26px; font-weight: 900; }
        .logo span:first-child { color: var(--primary); }
        .logo span:last-child { color: var(--secondary); text-shadow: 0 0 10px var(--secondary); }
        
        .search-box { flex: 1; margin: 0 20px; max-width: 500px; display: none; }
        @media(min-width: 768px) { .search-box { display: block; } }
        .search-box input { width: 100%; padding: 10px 15px; border-radius: 20px; border: 1px solid #ddd; background: #f9f9f9; }

        .nav-tools { display: flex; gap: 15px; align-items: center; }
        .lang-select { border: 1px solid #ddd; padding: 5px; border-radius: 5px; background: var(--bg-card); color: var(--text-main); font-size: 14px; cursor: pointer; }
        .icon-btn { font-size: 1.2rem; cursor: pointer; position: relative; }
        .badge { position: absolute; top: -8px; right: -8px; background: red; color: white; font-size: 10px; padding: 3px 6px; border-radius: 50%; }

        /* --- Sidebar --- */
        .sidebar { position: fixed; top: 0; width: 280px; height: 100%; background: var(--bg-card); z-index: 1000; padding: 20px; transition: 0.3s; box-shadow: 5px 0 15px rgba(0,0,0,0.1); }
        html[dir="rtl"] .sidebar { right: -290px; } html[dir="rtl"] .sidebar.active { right: 0; }
        html[dir="ltr"] .sidebar { left: -290px; } html[dir="ltr"] .sidebar.active { left: 0; }
        
        .cat-link { padding: 12px; margin-bottom: 5px; border-radius: 8px; cursor: pointer; transition: 0.2s; font-weight: 600; display:flex; justify-content:space-between; }
        .cat-link:hover { background: var(--primary); color: #fff; }

        /* --- Pages Management --- */
        .page-section { display: none; min-height: 80vh; animation: fadeIn 0.4s; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

        /* --- Slider --- */
        .hero-slider { height: 250px; position: relative; overflow: hidden; }
        @media(min-width: 768px) { .hero-slider { height: 450px; } }
        .slide { position: absolute; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: 1s; }
        .slide.active { opacity: 1; }

        /* --- Ticker --- */
        .ticker-wrap { background: var(--ticker-bg); overflow: hidden; height: 45px; display: flex; align-items: center; border-bottom: 1px solid #ddd; }
        .ticker-content { white-space: nowrap; font-weight: 800; color: #000; font-size: 15px; display: inline-block; padding-left: 100%; }
        
        /* --- Products Grid --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        @media(min-width: 768px) { .grid { grid-template-columns: repeat(4, 1fr); gap: 30px; } }

        .product-card { background: var(--bg-card); border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); transition: 0.3s; cursor: pointer; position: relative; border: 1px solid rgba(0,0,0,0.05); }
        .product-card:hover { transform: translateY(-7px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .p-img { width: 100%; height: 200px; object-fit: contain; background: #fff; padding: 10px; }
        .p-info { padding: 15px; }
        .p-cat { font-size: 11px; color: var(--text-sub); text-transform: uppercase; font-weight: bold; letter-spacing: 1px; }
        .p-title { font-weight: 700; margin: 5px 0; font-size: 15px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .p-price { color: var(--primary); font-weight: 800; font-size: 1.1rem; }
        
        /* --- Product Page (Not Floating) --- */
        #product-full-page { background: var(--bg-card); padding-top: 20px; }
        .prod-container { max-width: 1100px; margin: 0 auto; display: flex; flex-direction: column; gap: 30px; padding: 20px; }
        @media(min-width: 768px) { .prod-container { flex-direction: row; } }
        
        .prod-gallery { flex: 1.2; background: #fff; border-radius: 10px; overflow: hidden; position: relative; }
        .main-view-img { width: 100%; height: auto; max-height: 500px; object-fit: contain; }
        .thumbs-row { display: flex; gap: 10px; padding: 10px; overflow-x: auto; }
        .thumb-img { width: 70px; height: 70px; border: 2px solid #eee; border-radius: 5px; cursor: pointer; object-fit: cover; }
        .thumb-img.active { border-color: var(--primary); }

        .prod-details { flex: 1; padding: 10px; }
        .back-btn { display: inline-flex; align-items: center; gap: 5px; cursor: pointer; margin-bottom: 20px; font-weight: bold; color: var(--text-sub); }
        .prod-title { font-size: 2rem; font-weight: 900; margin-bottom: 10px; }
        .prod-price { font-size: 1.8rem; color: var(--secondary); font-weight: bold; margin-bottom: 20px; }
        .prod-desc { color: var(--text-sub); line-height: 1.6; margin-bottom: 20px; font-size: 1.1rem; }
        
        .action-area { background: #f9f9f9; padding: 20px; border-radius: 10px; margin-top: 20px; }
        .form-row { margin-bottom: 15px; }
        .form-row label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; }
        .form-input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; }
        .btn-main { width: 100%; padding: 15px; background: var(--primary); color: #fff; font-weight: bold; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; transition: 0.3s; }
        .btn-main:hover { background: var(--secondary); }

        /* --- Footer Professional --- */
        footer { background: #111; color: #bbb; padding: 60px 20px 20px; margin-top: 50px; font-size: 14px; }
        .footer-grid { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 40px; }
        .footer-col h3 { color: #fff; margin-bottom: 20px; font-size: 18px; border-bottom: 2px solid var(--secondary); display: inline-block; padding-bottom: 5px; }
        .footer-links a { display: block; margin-bottom: 10px; color: #bbb; transition: 0.3s; }
        .footer-links a:hover { color: var(--secondary); padding-inline-start: 5px; }
        .social-icons a { margin-inline-end: 15px; font-size: 18px; color: #fff; }
        .footer-form input, .footer-form textarea { width: 100%; padding: 10px; margin-bottom: 10px; background: #222; border: 1px solid #333; color: #fff; border-radius: 4px; }
        .footer-bottom { border-top: 1px solid #333; margin-top: 50px; padding-top: 20px; text-align: center; }

        /* --- ADMIN PANEL --- */
        .admin-overlay { position: fixed; inset: 0; background: #fff; z-index: 5000; display: none; align-items: center; justify-content: center; }
        #admin-panel { display: none; min-height: 100vh; background: #f1f5f9; }
        .admin-nav { background: #fff; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px; max-width: 1000px; margin: 0 auto; }
        .stat-card { background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; flex-direction: column; justify-content: center; align-items: center; border-bottom: 4px solid var(--primary); }
        .stat-val { font-size: 2.5rem; font-weight: bold; color: var(--text-main); }
        .stat-label { color: var(--text-sub); font-size: 1rem; }

        .admin-content { max-width: 1000px; margin: 20px auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: none; }
        .admin-content.active { display: block; }
        
        .admin-tabs { display: flex; justify-content: center; gap: 10px; padding: 20px 0; background: #fff; }
        .tab-btn { padding: 10px 25px; border: none; background: #e2e8f0; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .tab-btn.active { background: var(--primary); color: #fff; }

        /* Animations */
        @keyframes ticker-rtl { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        @keyframes ticker-ltr { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        .check-anim { font-size: 80px; color: #2ecc71; animation: pop 0.5s; }
        @keyframes pop { 0%{transform:scale(0)} 70%{transform:scale(1.2)} 100%{transform:scale(1)} }

    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <div style="display: flex; gap:15px; align-items: center;">
            <div class="icon-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
            <div class="logo"><span>Kahra</span><span>Light</span></div>
        </div>

        <div class="search-box">
            <input type="text" id="searchInput" onkeyup="renderProds(null, this.value)" placeholder="Search...">
        </div>

        <div class="nav-tools">
            <select class="lang-select" onchange="changeLang(this.value)">
                <option value="ar">ðŸ‡©ðŸ‡¿ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
                <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
                <option value="en">ðŸ‡¬ðŸ‡§ English</option>
            </select>
            <div class="icon-btn" onclick="openAdminLogin()"><i class="fas fa-user-circle"></i></div>
            <div class="icon-btn"><i class="fas fa-shopping-bag"></i> <span class="badge" id="cartCount">0</span></div>
        </div>
    </header>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px; padding-bottom:10px; border-bottom:2px solid #eee;">
            <h3 data-key="categories">Categories</h3>
            <i class="fas fa-times" onclick="toggleSidebar()" style="cursor:pointer; font-size:20px;"></i>
        </div>
        <div id="cat-list"></div>
    </div>

    <!-- MAIN HOME PAGE -->
    <div id="page-home" class="page-section active">
        <!-- Slider -->
        <div class="hero-slider" id="slider-container"></div>
        
        <!-- Ticker -->
        <div class="ticker-wrap">
            <div class="ticker-content" id="ticker-text"></div>
        </div>

        <!-- Products -->
        <div class="container">
            <h2 style="margin-bottom: 25px; border-inline-start: 5px solid var(--secondary); padding-inline-start: 10px;" data-key="all_products">All Products</h2>
            <div class="grid" id="product-grid"></div>
        </div>

        <!-- Footer -->
        <footer>
            <div class="footer-grid">
                <div class="footer-col">
                    <h3 data-key="about">About Us</h3>
                    <p data-key="about_text" style="line-height:1.6;">KahraLight is your #1 source for electrical supplies. High quality, best prices, and international shipping.</p>
                    <div class="social-icons" style="margin-top:15px;">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h3 data-key="links">Quick Links</h3>
                    <div class="footer-links">
                        <a href="#" data-key="home">Home</a>
                        <a href="#" data-key="privacy">Privacy Policy</a>
                        <a href="#" data-key="contact">Contact Us</a>
                        <a href="#" data-key="conditions">Terms & Conditions</a>
                    </div>
                </div>
                <div class="footer-col">
                    <h3 data-key="report">Report a Problem</h3>
                    <form class="footer-form" onsubmit="submitReport(event)">
                        <input type="text" id="rep-name" placeholder="Name" required>
                        <input type="email" id="rep-email" placeholder="Email" required>
                        <textarea id="rep-msg" rows="3" placeholder="Message" required></textarea>
                        <button style="background:var(--secondary); border:none; padding:8px 15px; color:#000; font-weight:bold; cursor:pointer;" data-key="send">Send</button>
                    </form>
                </div>
            </div>
            <div class="footer-bottom">
                &copy; 2024 KahraLight Store. All Rights Reserved.
            </div>
        </footer>
    </div>

    <!-- PRODUCT FULL PAGE (SPA Style) -->
    <div id="page-product" class="page-section">
        <div class="container">
            <div class="back-btn" onclick="showPage('home')">
                <i class="fas fa-arrow-left"></i> <span data-key="back">Back</span>
            </div>
            <div class="prod-container">
                <div class="prod-gallery">
                    <img id="view-img" class="main-view-img" src="">
                    <div class="thumbs-row" id="view-thumbs"></div>
                </div>
                <div class="prod-details">
                    <div class="p-cat" id="view-cat"></div>
                    <h1 class="prod-title" id="view-title"></h1>
                    <div class="prod-price" id="view-price"></div>
                    <div class="prod-desc" id="view-desc"></div>
                    
                    <div style="margin: 20px 0; display:flex; gap:15px;">
                        <a href="#" style="color:var(--primary); text-decoration:underline;"><i class="fas fa-file-pdf"></i> Fiche Technique</a>
                        <a href="#" style="color:var(--primary); text-decoration:underline;"><i class="fas fa-certificate"></i> Certificat Export</a>
                    </div>

                    <div class="action-area">
                        <h3 style="margin-bottom:15px;" data-key="order_form">Order Form</h3>
                        <div class="form-row" style="display:flex; gap:10px;">
                            <div style="flex:1">
                                <label data-key="qty">Quantity</label>
                                <input type="number" id="ord-qty" value="1" min="1" class="form-input">
                            </div>
                            <div style="flex:1">
                                <label data-key="color">Color</label>
                                <select id="ord-color" class="form-input"></select>
                            </div>
                        </div>
                        <div class="form-row">
                            <label data-key="name">Full Name</label>
                            <input type="text" id="ord-name" class="form-input">
                        </div>
                        <div class="form-row">
                            <label data-key="phone">Phone Number</label>
                            <input type="tel" id="ord-phone" class="form-input">
                        </div>
                        <div class="form-row">
                            <label data-key="country">Country</label>
                            <select id="ord-country" class="form-input">
                                <option value="Algeria">Algeria ðŸ‡©ðŸ‡¿</option>
                                <option value="Spain">Spain ðŸ‡ªðŸ‡¸</option>
                                <option value="France">France ðŸ‡«ðŸ‡·</option>
                                <option value="Portugal">Portugal ðŸ‡µðŸ‡¹</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label data-key="address">Address</label>
                            <textarea id="ord-addr" class="form-input"></textarea>
                        </div>
                        <button class="btn-main" onclick="submitOrder()" data-key="buy_now">Confirm Order</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Overlay -->
    <div id="success-overlay" class="admin-overlay" style="background:rgba(255,255,255,0.95); flex-direction:column;">
        <i class="fas fa-check-circle check-anim"></i>
        <h2 style="margin-top:20px; color:#333;" data-key="success_order">Order Successful!</h2>
    </div>

    <!-- ADMIN LOGIN -->
    <div id="admin-login" class="admin-overlay">
        <div style="background:#fff; padding:40px; border-radius:12px; box-shadow:0 5px 20px rgba(0,0,0,0.1); width:90%; max-width:350px; text-align:center;">
            <h2 style="color:var(--primary); margin-bottom:20px;">Admin Access</h2>
            <input type="text" id="adm-user" placeholder="Username" class="form-input" style="margin-bottom:10px;">
            <input type="password" id="adm-pass" placeholder="Password" class="form-input" style="margin-bottom:20px;">
            <button onclick="login()" class="btn-main">Login</button>
            <p id="login-msg" style="color:red; margin-top:10px; display:none;">Invalid Credentials</p>
            <button onclick="document.getElementById('admin-login').style.display='none'" style="background:none; border:none; margin-top:15px; text-decoration:underline; cursor:pointer;">Cancel</button>
        </div>
    </div>

    <!-- ADMIN DASHBOARD -->
    <div id="admin-panel">
        <div class="admin-nav">
            <h3>Admin Dashboard</h3>
            <div>
                <button onclick="logout()" style="background:#e74c3c; color:#fff; padding:8px 15px; border:none; border-radius:5px; cursor:pointer;">Logout</button>
                <button onclick="closeAdmin()" style="background:#34495e; color:#fff; padding:8px 15px; border:none; border-radius:5px; cursor:pointer;">View Store</button>
            </div>
        </div>

        <div class="admin-tabs">
            <button class="tab-btn active" onclick="switchTab('dash')">Dashboard</button>
            <button class="tab-btn" onclick="switchTab('products')">Products</button>
            <button class="tab-btn" onclick="switchTab('orders')">Orders</button>
            <button class="tab-btn" onclick="switchTab('settings')">Settings</button>
        </div>

        <!-- Dashboard Stats -->
        <div id="tab-dash" class="admin-content active" style="background:transparent; box-shadow:none; padding:0;">
            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="stat-val" id="st-visits">0</div>
                    <div class="stat-label">Total Visits</div>
                </div>
                <div class="stat-card">
                    <div class="stat-val" id="st-today">0</div>
                    <div class="stat-label">Visits Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-val" id="st-orders">0</div>
                    <div class="stat-label">New Orders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-val" id="st-revenue">0</div>
                    <div class="stat-label">Total Revenue</div>
                </div>
            </div>
        </div>

        <!-- Products Management -->
        <div id="tab-products" class="admin-content">
            <h3>Manage Products</h3>
            <div style="background:#f8fafc; padding:20px; border-radius:10px; margin-bottom:20px; border:1px solid #e2e8f0;">
                <input type="hidden" id="edit-id">
                <div class="form-row">
                    <input type="text" id="np-name" placeholder="Product Name (Main)" class="form-input">
                </div>
                <div class="form-row" style="display:flex; gap:10px;">
                    <input type="number" id="np-price-dz" placeholder="Price (DZD)" class="form-input">
                    <input type="number" id="np-price-eu" placeholder="Price (Euro)" class="form-input">
                </div>
                <div class="form-row" style="display:flex; gap:10px;">
                     <input type="text" id="np-cat" placeholder="Category" class="form-input">
                     <input type="text" id="np-colors" placeholder="Colors (comma separated)" class="form-input">
                </div>
                <div class="form-row">
                    <textarea id="np-desc" placeholder="Description" class="form-input"></textarea>
                </div>
                <div class="form-row">
                    <input type="text" id="np-img" placeholder="Images URLs (comma separated)" class="form-input">
                </div>
                <button onclick="saveProduct()" class="btn-main" style="background:#27ae60;">Save / Update Product</button>
                <button onclick="clearForm()" style="margin-top:10px; background:#95a5a6; border:none; padding:10px; color:#fff; border-radius:5px; cursor:pointer;">Clear Form</button>
            </div>
            
            <div id="admin-prod-list"></div>
        </div>

        <!-- Orders -->
        <div id="tab-orders" class="admin-content">
            <h3>Recent Orders</h3>
            <div style="overflow-x:auto;">
                <table style="width:100%; border-collapse:collapse; margin-top:15px;">
                    <thead style="background:#f1f1f1;">
                        <tr><th style="padding:10px;">Date</th><th>Customer</th><th>Product</th><th>Price</th><th>Action</th></tr>
                    </thead>
                    <tbody id="admin-orders-table"></tbody>
                </table>
            </div>
        </div>

        <!-- Settings -->
        <div id="tab-settings" class="admin-content">
            <h3>Global Settings</h3>
            <div class="form-row">
                <label>Store Theme (Applies to All Users)</label>
                <select id="set-theme" class="form-input" onchange="updateGlobalSettings()">
                    <option value="default">Default (Blue/Orange)</option>
                    <option value="theme-dark-blue">Dark Blue Mode</option>
                    <option value="theme-orange-blue">Orange Primary</option>
                    <option value="theme-yellow-white">Yellow & White</option>
                </select>
            </div>
            
            <hr style="margin:20px 0; border:0; border-top:1px solid #eee;">
            <h3>Ticker Text (Auto Translate Simulation)</h3>
            <p style="font-size:12px; color:#666; margin-bottom:10px;">Enter text for each language:</p>
            <div class="form-row"><input type="text" id="tick-ar" placeholder="Arabic Text" class="form-input"></div>
            <div class="form-row"><input type="text" id="tick-fr" placeholder="French Text" class="form-input"></div>
            <div class="form-row"><input type="text" id="tick-es" placeholder="Spanish Text" class="form-input"></div>
            <div class="form-row"><input type="text" id="tick-en" placeholder="English Text" class="form-input"></div>
            <button onclick="updateGlobalSettings()" class="btn-main">Save All Settings</button>

            <hr style="margin:20px 0;">
            <h3>Slider Images</h3>
            <div class="form-row">
                <input type="text" id="slider-url" placeholder="Image URL" class="form-input">
                <button onclick="addSlideImg()" style="margin-top:5px; padding:10px; background:#333; color:#fff; border:none; border-radius:5px;">Add Slide</button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, doc, setDoc, onSnapshot, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // FIREBASE CONFIG
        const firebaseConfig = {
          apiKey: "AIzaSyC5dRvQZE1kMSsYojrMiyuQurnQwEleo3o",
          projectId: "mourafik-e9161",
          appId: "1:133465287328:web:9de5b3bd709099d885b7c5"
        };

        // Init Firebase
        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
        } catch(e) { console.error("Firebase Fallback", e); }

        // STATE
        let currentState = {
            lang: 'ar',
            currency: 'DA',
            products: [],
            orders: [],
            settings: {
                theme: 'default',
                slider: ['https://via.placeholder.com/1200x400/0044cc/ffffff?text=KahraLight+Promo', 'https://via.placeholder.com/1200x400/ff9900/ffffff?text=New+Collection'],
                ticker: {
                    ar: 'Ù…Ø±Ø­Ø¨Ø§ Ø¨ÙƒÙ… ÙÙŠ ÙƒÙ‡Ø±Ø§Ù„Ø§ÙŠØª - Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',
                    fr: 'Bienvenue chez KahraLight',
                    es: 'Bienvenido a KahraLight',
                    en: 'Welcome to KahraLight Store'
                }
            },
            visits: 1250 // Simulated base visits
        };

        // DICTIONARY
        const i18n = {
            ar: { categories: 'Ø§Ù„ÙØ¦Ø§Øª', all_products: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª', about: 'Ù…Ù† Ù†Ø­Ù†', about_text: 'ÙƒÙ‡Ø±Ø§Ù„Ø§ÙŠØª Ù‡Ùˆ Ù…ØµØ¯Ø±Ùƒ Ø§Ù„Ø£ÙˆÙ„ Ù„Ù…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡.', links: 'Ø±ÙˆØ§Ø¨Ø·', home: 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', privacy: 'Ø§Ù„Ø®ØµÙˆØµÙŠØ©', contact: 'Ø§ØªØµÙ„ Ø¨Ù†Ø§', conditions: 'Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…', report: 'Ø§Ø¨Ù„Ø§Øº Ø¹Ù† Ù…Ø´ÙƒÙ„', send: 'Ø§Ø±Ø³Ø§Ù„', back: 'Ø¹ÙˆØ¯Ø©', order_form: 'Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨', qty: 'Ø§Ù„ÙƒÙ…ÙŠØ©', color: 'Ø§Ù„Ù„ÙˆÙ†', name: 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„', phone: 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ', country: 'Ø§Ù„Ø¨Ù„Ø¯', address: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', buy_now: 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨', success_order: 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!', search: 'Ø¨Ø­Ø«...' },
            fr: { categories: 'CatÃ©gories', all_products: 'Tous les produits', about: 'Ã€ propos', about_text: 'Votre source nÂ°1 pour l\'Ã©lectricitÃ©.', links: 'Liens', home: 'Accueil', privacy: 'ConfidentialitÃ©', contact: 'Contact', conditions: 'Conditions', report: 'Signaler un problÃ¨me', send: 'Envoyer', back: 'Retour', order_form: 'Bon de commande', qty: 'QuantitÃ©', color: 'Couleur', name: 'Nom complet', phone: 'TÃ©lÃ©phone', country: 'Pays', address: 'Adresse', buy_now: 'Confirmer la commande', success_order: 'Commande rÃ©ussie!', search: 'Rechercher...' },
            es: { categories: 'CategorÃ­as', all_products: 'Todos los productos', about: 'Sobre nosotros', about_text: 'Su fuente n.Âº 1 de suministros elÃ©ctricos.', links: 'Enlaces', home: 'Inicio', privacy: 'Privacidad', contact: 'Contacto', conditions: 'Condiciones', report: 'Reportar problema', send: 'Enviar', back: 'Volver', order_form: 'Formulario de pedido', qty: 'Cantidad', color: 'Color', name: 'Nombre completo', phone: 'TelÃ©fono', country: 'PaÃ­s', address: 'DirecciÃ³n', buy_now: 'Confirmar pedido', success_order: 'Â¡Pedido exitoso!', search: 'Buscar...' },
            en: { categories: 'Categories', all_products: 'All Products', about: 'About Us', about_text: 'Your #1 source for electrical supplies.', links: 'Links', home: 'Home', privacy: 'Privacy', contact: 'Contact', conditions: 'Conditions', report: 'Report Problem', send: 'Send', back: 'Back', order_form: 'Order Form', qty: 'Quantity', color: 'Color', name: 'Full Name', phone: 'Phone', country: 'Country', address: 'Address', buy_now: 'Confirm Order', success_order: 'Order Successful!', search: 'Search...' }
        };

        // --- GLOBAL FUNCTIONS ---

        window.changeLang = (l) => {
            currentState.lang = l;
            document.documentElement.lang = l;
            document.documentElement.dir = l === 'ar' ? 'rtl' : 'ltr';
            currentState.currency = l === 'ar' ? 'DA' : 'â‚¬';
            
            // Translate UI
            document.querySelectorAll('[data-key]').forEach(el => {
                const k = el.getAttribute('data-key');
                if(i18n[l][k]) el.innerText = i18n[l][k];
            });
            document.querySelectorAll('input[placeholder]').forEach(el => {
                 // specific placeholders logic if needed, simplfied here
            });
            
            // Ticker Update & Direction
            const tText = currentState.settings.ticker[l] || currentState.settings.ticker['en'];
            const tEl = document.getElementById('ticker-text');
            tEl.innerText = tText;
            tEl.style.animation = l === 'ar' ? 'ticker-ltr 20s linear infinite' : 'ticker-rtl 20s linear infinite';

            // Refresh Products (for Price Currency)
            window.renderProds();
        };

        window.showPage = (pageName, prodId = null) => {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            if(pageName === 'home') {
                document.getElementById('page-home').classList.add('active');
                window.scrollTo(0,0);
            } else if (pageName === 'product' && prodId) {
                const p = currentState.products.find(x => x.id === prodId);
                if(p) {
                    document.getElementById('view-img').src = p.imgs[0];
                    // Thumbs
                    const tRow = document.getElementById('view-thumbs');
                    tRow.innerHTML = '';
                    p.imgs.forEach(src => {
                        tRow.innerHTML += `<img src="${src}" class="thumb-img" onclick="document.getElementById('view-img').src='${src}'">`;
                    });

                    document.getElementById('view-cat').innerText = p.cat;
                    document.getElementById('view-title').innerText = p.name;
                    
                    const price = currentState.lang === 'ar' ? `${p.price_dz} DA` : `${p.price_eu || (p.price_dz/200).toFixed(2)} â‚¬`;
                    document.getElementById('view-price').innerText = price;
                    document.getElementById('view-desc').innerText = p.desc;
                    
                    const colorSel = document.getElementById('ord-color');
                    colorSel.innerHTML = '';
                    p.colors.forEach(c => colorSel.innerHTML += `<option>${c}</option>`);
                    
                    window.currentProdId = prodId;
                    document.getElementById('page-product').classList.add('active');
                    window.scrollTo(0,0);
                }
            }
        };

        window.renderProds = (catFilter = null, searchQ = null) => {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = '';
            
            let list = currentState.products;
            if(catFilter) list = list.filter(p => p.cat === catFilter);
            if(searchQ) list = list.filter(p => p.name.toLowerCase().includes(searchQ.toLowerCase()));

            list.forEach(p => {
                const priceDisplay = currentState.lang === 'ar' ? `${p.price_dz} DA` : `${p.price_eu || (p.price_dz/200).toFixed(2)} â‚¬`;
                grid.innerHTML += `
                    <div class="product-card" onclick="showPage('product', '${p.id}')">
                        <img src="${p.imgs[0]}" class="p-img">
                        <div class="p-info">
                            <div class="p-cat">${p.cat}</div>
                            <div class="p-title">${p.name}</div>
                            <div class="p-price">${priceDisplay}</div>
                        </div>
                    </div>
                `;
            });
        };

        window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('active');

        window.submitOrder = async () => {
            const p = currentState.products.find(x => x.id === window.currentProdId);
            const order = {
                product: p.name,
                price: currentState.lang === 'ar' ? p.price_dz : p.price_eu,
                currency: currentState.currency,
                qty: document.getElementById('ord-qty').value,
                color: document.getElementById('ord-color').value,
                customer: document.getElementById('ord-name').value,
                phone: document.getElementById('ord-phone').value,
                country: document.getElementById('ord-country').value,
                address: document.getElementById('ord-addr').value,
                date: new Date().toLocaleDateString()
            };

            if(!order.customer || !order.phone) return alert("Please fill Name and Phone");

            if(db) await addDoc(collection(db, 'orders'), order);
            else {
                currentState.orders.unshift(order); // Local fallback
                updateAdminUI();
            }

            document.getElementById('success-overlay').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('success-overlay').style.display = 'none';
                showPage('home');
            }, 2500);
        };

        // --- ADMIN FUNCTIONS ---
        window.openAdminLogin = () => document.getElementById('admin-login').style.display = 'flex';
        
        window.login = () => {
            const u = document.getElementById('adm-user').value;
            const p = document.getElementById('adm-pass').value;
            if(u === 'admin' && p === 'abobob123') {
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('page-home').classList.remove('active');
                document.getElementById('admin-panel').style.display = 'block';
                updateAdminUI();
            } else {
                document.getElementById('login-msg').style.display = 'block';
            }
        };

        window.logout = () => window.location.reload();
        window.closeAdmin = () => {
             document.getElementById('admin-panel').style.display = 'none';
             showPage('home');
        };

        window.switchTab = (t) => {
            document.querySelectorAll('.admin-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active');
            event.target.classList.add('active');
        };

        window.saveProduct = async () => {
            const id = document.getElementById('edit-id').value || Date.now().toString();
            const prodData = {
                id: id,
                name: document.getElementById('np-name').value,
                price_dz: Number(document.getElementById('np-price-dz').value),
                price_eu: Number(document.getElementById('np-price-eu').value),
                cat: document.getElementById('np-cat').value,
                desc: document.getElementById('np-desc').value,
                colors: document.getElementById('np-colors').value.split(',').map(s=>s.trim()),
                imgs: document.getElementById('np-img').value.split(',').map(s=>s.trim())
            };

            if(db) {
                // Determine if add or update based on existence (Simplified: always setDoc for this demo logic)
                await setDoc(doc(db, "products", id.toString()), prodData);
            } else {
                // Local Logic
                const idx = currentState.products.findIndex(p => p.id.toString() === id);
                if(idx >= 0) currentState.products[idx] = prodData;
                else currentState.products.push(prodData);
                renderProds(); // update views
            }
            alert('Product Saved for All Users');
            window.clearForm();
        };

        window.editProduct = (id) => {
            const p = currentState.products.find(x => x.id == id);
            if(!p) return;
            document.getElementById('edit-id').value = p.id;
            document.getElementById('np-name').value = p.name;
            document.getElementById('np-price-dz').value = p.price_dz;
            document.getElementById('np-price-eu').value = p.price_eu || '';
            document.getElementById('np-cat').value = p.cat;
            document.getElementById('np-desc').value = p.desc;
            document.getElementById('np-colors').value = p.colors.join(',');
            document.getElementById('np-img').value = p.imgs.join(',');
            window.scrollTo(0,0);
        };

        window.deleteProduct = async (id) => {
            if(confirm('Delete?')) {
                if(db) await deleteDoc(doc(db, 'products', id.toString()));
                else {
                    currentState.products = currentState.products.filter(p => p.id != id);
                    renderProds();
                    updateAdminUI();
                }
            }
        };

        window.clearForm = () => {
            document.getElementById('edit-id').value = '';
            document.querySelectorAll('#tab-products input, #tab-products textarea').forEach(i => i.value = '');
        };

        window.updateGlobalSettings = async () => {
            const newSettings = {
                theme: document.getElementById('set-theme').value,
                ticker: {
                    ar: document.getElementById('tick-ar').value || currentState.settings.ticker.ar,
                    fr: document.getElementById('tick-fr').value || currentState.settings.ticker.fr,
                    es: document.getElementById('tick-es').value || currentState.settings.ticker.es,
                    en: document.getElementById('tick-en').value || currentState.settings.ticker.en,
                },
                slider: currentState.settings.slider
            };
            
            if(db) await setDoc(doc(db, 'settings', 'main'), newSettings);
            else {
                currentState.settings = newSettings;
                applySettings();
            }
            alert('Settings Updated Globally');
        };

        window.addSlideImg = () => {
            const url = document.getElementById('slider-url').value;
            if(url) {
                currentState.settings.slider.push(url);
                window.updateGlobalSettings(); // Save to DB
            }
        };

        function updateAdminUI() {
            // Stats
            document.getElementById('st-visits').innerText = currentState.visits + Math.floor(Math.random()*10); // Simulated live
            document.getElementById('st-today').innerText = 45; 
            document.getElementById('st-orders').innerText = currentState.orders.length;
            const rev = currentState.orders.reduce((sum, o) => sum + (o.currency === 'DA' ? o.price : o.price*200), 0);
            document.getElementById('st-revenue').innerText = rev.toFixed(0) + " DA eq";

            // Product List
            const pl = document.getElementById('admin-prod-list');
            pl.innerHTML = '';
            currentState.products.forEach(p => {
                pl.innerHTML += `
                    <div style="background:#fff; padding:10px; margin-bottom:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                        <div style="display:flex; gap:10px; align-items:center;">
                            <img src="${p.imgs[0]}" style="width:40px; height:40px; object-fit:cover; border-radius:4px;">
                            <strong>${p.name}</strong>
                        </div>
                        <div>
                            <button onclick="editProduct('${p.id}')" style="background:orange; border:none; padding:5px 10px; color:#fff; border-radius:4px; cursor:pointer;">Edit</button>
                            <button onclick="deleteProduct('${p.id}')" style="background:red; border:none; padding:5px 10px; color:#fff; border-radius:4px; cursor:pointer;">Delete</button>
                        </div>
                    </div>`;
            });

            // Order Table
            const ot = document.getElementById('admin-orders-table');
            ot.innerHTML = '';
            currentState.orders.forEach(o => {
                ot.innerHTML += `<tr>
                    <td style="padding:10px;">${o.date}</td>
                    <td>${o.customer}</td>
                    <td>${o.product}</td>
                    <td>${o.price} ${o.currency}</td>
                    <td><button style="font-size:12px;">View</button></td>
                </tr>`;
            });
        }

        function applySettings() {
            // Apply Theme
            document.body.className = currentState.settings.theme;
            
            // Apply Ticker (refresh based on lang)
            changeLang(currentState.lang);

            // Apply Slider
            const sl = document.getElementById('slider-container');
            sl.innerHTML = '';
            currentState.settings.slider.forEach((src, i) => {
                sl.innerHTML += `<img src="${src}" class="slide ${i===0?'active':''}">`;
            });
            // Restart Animation logic (simple)
            let sIdx = 0;
            if(window.sliderInt) clearInterval(window.sliderInt);
            window.sliderInt = setInterval(() => {
                const slides = document.querySelectorAll('.slide');
                if(slides.length > 0) {
                    slides[sIdx].classList.remove('active');
                    sIdx = (sIdx + 1) % slides.length;
                    slides[sIdx].classList.add('active');
                }
            }, 3000);
        }

        // --- FIREBASE LISTENERS (REAL-TIME UPDATES) ---
        function initListeners() {
            if(!db) {
                // Add dummy data if no DB
                currentState.products.push({id:'1', name:'Smart LED Bulb', cat:'Lighting', price_dz: 1500, price_eu: 7.5, desc:'Control via Phone', colors:['White', 'RGB'], imgs:['https://via.placeholder.com/400?text=Bulb']});
                currentState.products.push({id:'2', name:'Classic Chandelier', cat:'Decor', price_dz: 25000, price_eu: 125, desc:'Luxury Crystal', colors:['Gold'], imgs:['https://via.placeholder.com/400?text=Chandelier']});
                renderProds();
                renderCats();
                applySettings();
                return;
            }

            // Products Listener
            onSnapshot(collection(db, "products"), (snap) => {
                const prods = [];
                snap.forEach(doc => prods.push(doc.data()));
                currentState.products = prods;
                renderProds();
                renderCats();
                updateAdminUI(); // If admin is open
            });

            // Settings Listener
            onSnapshot(doc(db, "settings", "main"), (doc) => {
                if(doc.exists()) {
                    currentState.settings = doc.data();
                    applySettings();
                    // Populate inputs
                    document.getElementById('set-theme').value = currentState.settings.theme;
                    document.getElementById('tick-ar').value = currentState.settings.ticker.ar;
                    document.getElementById('tick-fr').value = currentState.settings.ticker.fr;
                    document.getElementById('tick-es').value = currentState.settings.ticker.es;
                    document.getElementById('tick-en').value = currentState.settings.ticker.en;
                }
            });

            // Orders Listener (Admin only usually, but loaded here for dashboard)
            onSnapshot(collection(db, "orders"), (snap) => {
                const ords = [];
                snap.forEach(doc => ords.push(doc.data()));
                currentState.orders = ords.sort((a,b) => new Date(b.date) - new Date(a.date));
                if(document.getElementById('admin-panel').style.display === 'block') updateAdminUI();
            });
        }

        function renderCats() {
            const cats = [...new Set(currentState.products.map(p => p.cat))];
            const cl = document.getElementById('cat-list');
            cl.innerHTML = `<div class="cat-link" onclick="renderProds(); toggleSidebar()">All / Ø§Ù„ÙƒÙ„</div>`;
            cats.forEach(c => {
                cl.innerHTML += `<div class="cat-link" onclick="renderProds('${c}'); toggleSidebar()"><span>${c}</span> <i class="fas fa-chevron-right" style="font-size:12px"></i></div>`;
            });
        }

        // START
        initListeners();
        changeLang('ar');
        
        // Simulating View Counter
        setInterval(() => { currentState.visits++; if(document.getElementById('admin-panel').style.display === 'block') document.getElementById('st-visits').innerText = currentState.visits; }, 10000);

    </script>
</body>
</html>
