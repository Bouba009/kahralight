<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KahraLight Store</title>
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- DEFAULT THEME (Dark Blue) --- */
        :root {
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --bg-input: #334155;
            --text-main: #ffffff;
            --text-sub: #94a3b8;
            --primary: #3b82f6; /* Blue */
            --secondary: #f59e0b; /* Orange/Gold */
            --accent: #22c55e;
            --ticker-bg: #fff700;
            --ticker-text: #000;
            --radius: 12px;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }

        /* Light Theme (Alternative) */
        body.theme-light {
            --bg-body: #f8f9fa;
            --bg-card: #ffffff;
            --bg-input: #f1f5f9;
            --text-main: #1a1a1a;
            --text-sub: #64748b;
            --primary: #0044cc;
            --secondary: #ff9900;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; font-family: 'Cairo', 'Roboto', sans-serif; }
        
        body { background-color: var(--bg-body); color: var(--text-main); transition: background 0.3s, color 0.3s; padding-bottom: 0; }
        a { text-decoration: none; color: inherit; }
        ul { list-style: none; }
        img { max-width: 100%; display: block; }
        input, select, textarea { font-family: inherit; }

        /* --- UI COMPONENTS --- */
        
        /* Header */
        header { background: var(--bg-card); padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 900; box-shadow: var(--shadow); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .logo { font-size: 26px; font-weight: 900; letter-spacing: -1px; }
        .logo span:first-child { color: var(--primary); }
        .logo span:last-child { color: var(--secondary); text-shadow: 0 0 15px rgba(245, 158, 11, 0.4); }
        
        .search-box { flex: 1; margin: 0 20px; max-width: 500px; display: none; }
        @media(min-width: 768px) { .search-box { display: block; } }
        .search-box input { width: 100%; padding: 12px 20px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.1); background: var(--bg-input); color: var(--text-main); transition: 0.3s; }
        .search-box input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }

        .nav-tools { display: flex; gap: 15px; align-items: center; }
        .lang-select { border: 1px solid rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 8px; background: var(--bg-input); color: var(--text-main); font-size: 14px; cursor: pointer; }
        .icon-btn { font-size: 1.3rem; cursor: pointer; position: relative; color: var(--text-sub); transition: 0.2s; }
        .icon-btn:hover { color: var(--text-main); }
        .badge { position: absolute; top: -5px; right: -5px; background: var(--secondary); color: #000; font-size: 10px; padding: 2px 6px; border-radius: 50%; font-weight: bold; }

        /* Sidebar */
        .sidebar { position: fixed; top: 0; width: 280px; height: 100%; background: var(--bg-card); z-index: 1000; padding: 20px; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: var(--shadow); }
        html[dir="rtl"] .sidebar { right: -300px; border-left: 1px solid rgba(255,255,255,0.05); } 
        html[dir="rtl"] .sidebar.active { right: 0; }
        html[dir="ltr"] .sidebar { left: -300px; border-right: 1px solid rgba(255,255,255,0.05); } 
        html[dir="ltr"] .sidebar.active { left: 0; }
        
        .cat-link { padding: 14px; margin-bottom: 8px; border-radius: 8px; cursor: pointer; transition: 0.2s; font-weight: 600; display:flex; justify-content:space-between; color: var(--text-sub); }
        .cat-link:hover, .cat-link.active { background: var(--primary); color: #fff; }

        /* Page Routing Logic */
        .page-view { display: none; animation: fadeIn 0.5s ease; min-height: 80vh; }
        .page-view.active { display: block; }
        @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

        /* Slider */
        .hero-slider { height: 220px; position: relative; overflow: hidden; margin-bottom: 0; }
        @media(min-width: 768px) { .hero-slider { height: 450px; } }
        .slide { position: absolute; top:0; left:0; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.8s ease-in-out; }
        .slide.active { opacity: 1; }
        
        /* Ticker */
        .ticker-wrap { background: var(--ticker-bg); overflow: hidden; height: 45px; display: flex; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.1); }
        .ticker-content { white-space: nowrap; font-weight: 800; color: var(--ticker-text); font-size: 16px; display: inline-block; padding-left: 100%; }

        /* Products Grid */
        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        @media(min-width: 768px) { .grid { grid-template-columns: repeat(4, 1fr); gap: 30px; } }

        .product-card { background: var(--bg-card); border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); transition: all 0.3s ease; cursor: pointer; border: 1px solid rgba(255,255,255,0.05); position: relative; }
        .product-card:hover { transform: translateY(-10px); box-shadow: 0 20px 30px rgba(0,0,0,0.2); border-color: var(--primary); }
        .p-img-box { height: 200px; background: #fff; position: relative; overflow: hidden; }
        .p-img { width: 100%; height: 100%; object-fit: contain; padding: 15px; transition: transform 0.5s; }
        .product-card:hover .p-img { transform: scale(1.1); }
        .p-info { padding: 15px; }
        .p-cat { font-size: 11px; color: var(--text-sub); text-transform: uppercase; font-weight: bold; letter-spacing: 1px; }
        .p-title { font-weight: 700; margin: 8px 0; font-size: 16px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-main); }
        .p-price { color: var(--secondary); font-weight: 800; font-size: 1.2rem; display: flex; align-items: center; gap: 5px; }

        /* --- PRODUCT DETAILS PAGE (SEPARATE) --- */
        #view-product { background: var(--bg-body); padding-bottom: 50px; }
        .prod-layout { display: flex; flex-direction: column; gap: 30px; margin-top: 20px; }
        @media(min-width: 768px) { .prod-layout { flex-direction: row; } }
        
        .gallery-sec { flex: 1.3; }
        .main-img-wrap { background: #fff; border-radius: 15px; padding: 20px; margin-bottom: 15px; box-shadow: var(--shadow); height: 400px; display: flex; align-items: center; justify-content: center; }
        .main-img-wrap img { max-height: 100%; max-width: 100%; }
        .thumbs { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .thumb { width: 80px; height: 80px; border-radius: 10px; border: 2px solid transparent; cursor: pointer; object-fit: cover; background: #fff; }
        .thumb.active { border-color: var(--primary); }

        .details-sec { flex: 1; padding: 10px; }
        .back-link { display: inline-block; margin-bottom: 20px; color: var(--text-sub); cursor: pointer; font-weight: bold; }
        .back-link:hover { color: var(--primary); }
        
        .dt-title { font-size: 2rem; font-weight: 900; margin-bottom: 10px; color: var(--text-main); line-height: 1.2; }
        .dt-price { font-size: 2rem; color: var(--secondary); font-weight: bold; margin-bottom: 20px; }
        .dt-desc { color: var(--text-sub); line-height: 1.7; margin-bottom: 25px; font-size: 1.05rem; }
        
        .docs-area { display: flex; gap: 15px; margin-bottom: 30px; }
        .doc-btn { background: rgba(59, 130, 246, 0.1); color: var(--primary); padding: 10px 15px; border-radius: 8px; font-weight: bold; display: flex; align-items: center; gap: 8px; transition: 0.3s; }
        .doc-btn:hover { background: var(--primary); color: #fff; }

        /* Professional Order Form */
        .order-card { background: var(--bg-card); padding: 25px; border-radius: 15px; box-shadow: var(--shadow); border: 1px solid rgba(255,255,255,0.05); }
        .order-head { font-size: 1.2rem; font-weight: bold; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; }
        
        .form-group { margin-bottom: 15px; }
        .form-row { display: flex; gap: 15px; }
        .form-label { display: block; margin-bottom: 8px; font-size: 0.9rem; font-weight: bold; color: var(--text-sub); }
        .inp-field { width: 100%; background: var(--bg-input); border: 1px solid rgba(255,255,255,0.1); color: var(--text-main); padding: 12px; border-radius: 8px; transition: 0.3s; }
        .inp-field:focus { border-color: var(--primary); outline: none; }
        
        .btn-buy { width: 100%; background: linear-gradient(135deg, var(--secondary), #d97706); color: #fff; border: none; padding: 16px; border-radius: 10px; font-weight: 900; font-size: 1.1rem; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3); margin-top: 10px; }
        .btn-buy:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4); }

        /* Footer */
        footer { background: #020617; border-top: 1px solid rgba(255,255,255,0.05); padding: 60px 20px; margin-top: 60px; font-size: 14px; color: #64748b; }
        .footer-cols { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 40px; }
        .ft-head { color: #fff; font-size: 1.1rem; font-weight: bold; margin-bottom: 20px; }
        .ft-links a { display: block; margin-bottom: 10px; transition: 0.3s; }
        .ft-links a:hover { color: var(--primary); transform: translateX(5px); }
        .ft-form input, .ft-form textarea { width: 100%; background: #0f172a; border: 1px solid #1e293b; color: #fff; padding: 10px; border-radius: 6px; margin-bottom: 10px; }

        /* --- ADMIN PANEL --- */
        #view-admin { background: #f1f5f9; min-height: 100vh; color: #1e293b; display: none; }
        .admin-nav { background: #fff; padding: 15px 30px; display: flex; justify-content: space-between; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        
        .dashboard-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; padding: 30px; max-width: 1200px; margin: 0 auto; }
        .d-card { padding: 25px; border-radius: 15px; color: #fff; display: flex; flex-direction: column; justify-content: space-between; height: 140px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); position: relative; overflow: hidden; }
        .d-card h3 { font-size: 2.5rem; font-weight: 900; margin: 0; z-index: 2; }
        .d-card p { font-size: 1rem; opacity: 0.9; z-index: 2; }
        .d-card i { position: absolute; right: -10px; bottom: -10px; font-size: 6rem; opacity: 0.2; transform: rotate(-15deg); }
        
        .c-blue { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .c-green { background: linear-gradient(135deg, #22c55e, #16a34a); }
        .c-orange { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .c-purple { background: linear-gradient(135deg, #a855f7, #9333ea); }

        .admin-section { background: #fff; border-radius: 15px; padding: 30px; margin: 0 30px 30px; max-width: 1200px; margin-left: auto; margin-right: auto; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .adm-tabs button { padding: 10px 20px; background: #e2e8f0; border: none; border-radius: 20px; margin-right: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .adm-tabs button.active { background: #1e293b; color: #fff; }

        .admin-input { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; margin-bottom: 15px; font-family: inherit; }
        .file-upload-box { border: 2px dashed #cbd5e1; padding: 20px; text-align: center; border-radius: 8px; margin-bottom: 15px; cursor: pointer; background: #f8fafc; }
        
        /* Anim */
        @keyframes ticker-rtl { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        @keyframes ticker-ltr { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        
        .login-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 5000; display: none; align-items: center; justify-content: center; }
        .success-anim { position: fixed; inset: 0; background: rgba(255,255,255,0.95); z-index: 6000; display: none; align-items: center; justify-content: center; flex-direction: column; color: #22c55e; }

    </style>
</head>
<body class="theme-dark">

    <!-- Header -->
    <header>
        <div style="display: flex; gap:15px; align-items: center;">
            <div class="icon-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
            <div class="logo" onclick="goHome()" style="cursor: pointer;"><span>Kahra</span><span>Light</span></div>
        </div>
        
        <div class="search-box">
            <input type="text" onkeyup="filterProducts(this.value)" placeholder="Search products...">
        </div>

        <div class="nav-tools">
            <select class="lang-select" onchange="changeLang(this.value)">
                <option value="ar">ðŸ‡©ðŸ‡¿ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
                <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
                <option value="en">ðŸ‡¬ðŸ‡§ English</option>
            </select>
            <div class="icon-btn" onclick="openAdminLogin()"><i class="fas fa-user-shield"></i></div>
            <div class="icon-btn"><i class="fas fa-shopping-cart"></i> <span class="badge" id="cartCount">0</span></div>
        </div>
    </header>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div style="display:flex; justify-content:space-between; margin-bottom:30px; padding-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.1);">
            <h3 data-key="categories">Categories</h3>
            <i class="fas fa-times" onclick="toggleSidebar()" style="cursor:pointer; font-size:20px; color:var(--text-sub);"></i>
        </div>
        <div id="cat-list"></div>
    </div>

    <!-- VIEW: HOME -->
    <div id="view-home" class="page-view active">
        <!-- Slider -->
        <div class="hero-slider" id="home-slider"></div>
        
        <!-- Ticker -->
        <div class="ticker-wrap"><div class="ticker-content" id="ticker-text"></div></div>

        <!-- Products -->
        <div class="container">
            <h2 style="margin-bottom: 30px; display:flex; align-items:center; gap:10px;">
                <span style="width:5px; height:30px; background:var(--secondary); display:block; border-radius:5px;"></span>
                <span data-key="all_products">All Products</span>
            </h2>
            <div class="grid" id="product-grid"></div>
        </div>

        <!-- Footer -->
        <footer>
            <div class="footer-cols">
                <div>
                    <div class="ft-head" data-key="about">About Us</div>
                    <p data-key="about_text">Top quality electrical supplies delivered to your door.</p>
                </div>
                <div class="ft-links">
                    <div class="ft-head" data-key="links">Links</div>
                    <a href="#" onclick="goHome()" data-key="home">Home</a>
                    <a href="#" data-key="contact">Contact</a>
                    <a href="#" data-key="privacy">Privacy</a>
                </div>
                <div>
                    <div class="ft-head" data-key="report">Report Issue</div>
                    <div class="ft-form">
                        <input type="text" placeholder="Name">
                        <textarea rows="2" placeholder="Message"></textarea>
                        <button class="btn-buy" style="padding:10px; font-size:0.9rem;" data-key="send">Send</button>
                    </div>
                </div>
            </div>
            <div style="text-align:center; margin-top:50px; opacity:0.5;">&copy; 2026 KahraLight.</div>
        </footer>
    </div>

    <!-- VIEW: PRODUCT DETAILS (Separate Page Logic) -->
    <div id="view-product" class="page-view">
        <div class="container">
            <div class="back-link" onclick="goHome()">
                <i class="fas fa-arrow-left"></i> <span data-key="back">Back to Store</span>
            </div>
            
            <div class="prod-layout">
                <!-- Gallery -->
                <div class="gallery-sec">
                    <div class="main-img-wrap">
                        <img id="dt-main-img" src="">
                    </div>
                    <div class="thumbs" id="dt-thumbs"></div>
                </div>

                <!-- Info & Form -->
                <div class="details-sec">
                    <div class="p-cat" id="dt-cat" style="color:var(--primary); margin-bottom:5px;"></div>
                    <h1 class="dt-title" id="dt-title"></h1>
                    <div class="dt-price" id="dt-price"></div>
                    <div class="dt-desc" id="dt-desc"></div>

                    <div class="docs-area">
                        <a href="#" class="doc-btn" id="link-cert"><i class="fas fa-certificate"></i> Certificat</a>
                        <a href="#" class="doc-btn" id="link-fiche"><i class="fas fa-file-pdf"></i> Fiche Tech.</a>
                    </div>

                    <!-- Professional Form -->
                    <div class="order-card">
                        <div class="order-head">
                            <span data-key="order_form">Order Form</span>
                            <i class="fas fa-shopping-bag" style="color:var(--secondary)"></i>
                        </div>
                        
                        <div class="form-row">
                            <div style="flex:1">
                                <label class="form-label" data-key="qty">Quantity</label>
                                <input type="number" id="ord-qty" value="1" min="1" class="inp-field">
                            </div>
                            <div style="flex:1">
                                <label class="form-label" data-key="color">Color</label>
                                <select id="ord-color" class="inp-field"></select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" data-key="name">Full Name</label>
                            <input type="text" id="ord-name" class="inp-field" placeholder="...">
                        </div>

                        <div class="form-row">
                            <div style="flex:1">
                                <label class="form-label" data-key="phone">Phone</label>
                                <input type="tel" id="ord-phone" class="inp-field" placeholder="05...">
                            </div>
                            <div style="flex:1">
                                <label class="form-label" data-key="country">Country</label>
                                <select id="ord-country" class="inp-field">
                                    <option>Algeria</option>
                                    <option>France</option>
                                    <option>Spain</option>
                                    <option>Portugal</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" data-key="address">Address</label>
                            <textarea id="ord-addr" class="inp-field" rows="2" placeholder="Wilaya, City..."></textarea>
                        </div>

                        <button class="btn-buy" onclick="placeOrder()">
                            <span data-key="buy_now">CONFIRM ORDER</span>
                            <i class="fas fa-check-circle" style="margin-inline-start:5px;"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW: ADMIN DASHBOARD -->
    <div id="view-admin">
        <div class="admin-nav">
            <h2 style="color:#0f172a;">Admin Dashboard</h2>
            <div>
                <button onclick="goHome()" style="padding:8px 15px; border:none; background:#cbd5e1; cursor:pointer; border-radius:5px;">Store</button>
                <button onclick="location.reload()" style="padding:8px 15px; border:none; background:#ef4444; color:#fff; cursor:pointer; border-radius:5px;">Logout</button>
            </div>
        </div>

        <div class="dashboard-cards">
            <div class="d-card c-blue">
                <h3>1,240</h3><p>Visits</p><i class="fas fa-eye"></i>
            </div>
            <div class="d-card c-green">
                <h3 id="adm-today">45</h3><p>Today</p><i class="fas fa-calendar-day"></i>
            </div>
            <div class="d-card c-orange">
                <h3 id="adm-orders">0</h3><p>Orders</p><i class="fas fa-shopping-cart"></i>
            </div>
            <div class="d-card c-purple">
                <h3 id="adm-rev">0 DA</h3><p>Revenue</p><i class="fas fa-wallet"></i>
            </div>
        </div>

        <div class="admin-section">
            <div class="adm-tabs" style="margin-bottom:20px;">
                <button class="active" onclick="admTab('prods')">Products</button>
                <button onclick="admTab('orders')">Orders</button>
                <button onclick="admTab('settings')">Settings</button>
            </div>

            <!-- Products Tab -->
            <div id="tab-prods">
                <div style="background:#f8fafc; padding:20px; border:1px solid #e2e8f0; border-radius:10px; margin-bottom:20px;">
                    <h3 style="margin-bottom:15px; color:#333;">Add / Edit Product</h3>
                    <input type="hidden" id="edit-id">
                    
                    <div class="form-row">
                        <input type="text" id="p-name" placeholder="Product Name" class="admin-input">
                        <input type="text" id="p-cat" placeholder="Category" class="admin-input">
                    </div>
                    <div class="form-row">
                        <input type="number" id="p-price-da" placeholder="Price (DA)" class="admin-input">
                        <input type="number" id="p-price-eu" placeholder="Price (â‚¬)" class="admin-input">
                    </div>
                    <textarea id="p-desc" placeholder="Description" class="admin-input"></textarea>
                    
                    <label style="font-weight:bold; display:block; margin-bottom:5px;">Product Image (URL OR Upload)</label>
                    <div class="form-row">
                        <input type="text" id="p-img-url" placeholder="Paste Image URL here..." class="admin-input">
                        <div class="file-upload-box" onclick="document.getElementById('p-img-file').click()">
                            <span>or Click to Upload File</span>
                            <input type="file" id="p-img-file" style="display:none" onchange="previewFile()">
                        </div>
                    </div>

                    <input type="text" id="p-colors" placeholder="Colors (comma separated)" class="admin-input">
                    <button onclick="saveProduct()" class="btn-buy" style="width:auto; padding:10px 30px;">Save Product</button>
                    
                    <!-- CSV Import -->
                    <div style="margin-top:20px; padding-top:20px; border-top:1px dashed #ccc;">
                        <input type="file" id="csv-file" accept=".csv">
                        <button onclick="importCSV()" style="padding:5px 10px;">Import CSV</button>
                    </div>
                </div>
                <div id="adm-prod-list"></div>
            </div>

            <!-- Orders Tab -->
            <div id="tab-orders" style="display:none;">
                <table style="width:100%; border-collapse:collapse;">
                    <thead style="background:#f1f5f9; text-align:left;">
                        <tr><th style="padding:10px;">Date</th><th>Customer</th><th>Item</th><th>Total</th></tr>
                    </thead>
                    <tbody id="adm-order-rows"></tbody>
                </table>
            </div>

            <!-- Settings Tab -->
            <div id="tab-settings" style="display:none;">
                <h3>Global Settings</h3>
                <label>Theme</label>
                <select id="set-theme" class="admin-input" onchange="saveSettings()">
                    <option value="theme-dark">Dark Blue (Default)</option>
                    <option value="theme-light">Light Mode</option>
                </select>
                
                <label>Slider Images (Add URLs)</label>
                <div class="form-row">
                    <input type="text" id="slide-url" class="admin-input" placeholder="Image URL">
                    <button onclick="addSlide()" style="height:45px; padding:0 20px;">Add</button>
                </div>
                
                <label>Ticker Text (Translate)</label>
                <input type="text" id="tick-ar" placeholder="Arabic" class="admin-input">
                <input type="text" id="tick-en" placeholder="English" class="admin-input">
                <button onclick="saveSettings()" class="btn-buy" style="width:auto;">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="login-modal" class="login-overlay">
        <div style="background:var(--bg-card); padding:30px; border-radius:15px; width:300px; text-align:center; border:1px solid rgba(255,255,255,0.1);">
            <h3 style="color:var(--primary); margin-bottom:15px;">Admin Login</h3>
            <input type="text" id="u-name" placeholder="admin" class="inp-field" style="margin-bottom:10px;">
            <input type="password" id="u-pass" placeholder="abobob123" class="inp-field" style="margin-bottom:15px;">
            <button onclick="doLogin()" class="btn-buy">ENTER</button>
            <p id="log-err" style="color:red; margin-top:10px; display:none;">Error!</p>
            <button onclick="document.getElementById('login-modal').style.display='none'" style="background:none; border:none; color:var(--text-sub); margin-top:10px; cursor:pointer;">Cancel</button>
        </div>
    </div>

    <div id="success-msg" class="success-anim">
        <i class="fas fa-check-circle" style="font-size:5rem; margin-bottom:20px;"></i>
        <h2>Order Placed Successfully!</h2>
        <p>We will contact you soon.</p>
    </div>

    <!-- LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, doc, setDoc, onSnapshot, deleteDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyC5dRvQZE1kMSsYojrMiyuQurnQwEleo3o",
          projectId: "mourafik-e9161",
          appId: "1:133465287328:web:9de5b3bd709099d885b7c5"
        };

        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
        } catch(e) { console.log("Local Mode"); }

        // --- STATE ---
        let state = {
            lang: 'ar',
            currency: 'DA',
            products: [],
            orders: [],
            settings: {
                theme: 'theme-dark',
                slider: ['https://images.unsplash.com/photo-1565814329452-e1efa11c5b89?q=80&w=1200', 'https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=1200'],
                ticker: { ar: 'Ù…Ø±Ø­Ø¨Ø§ Ø¨ÙƒÙ… ÙÙŠ ÙƒÙ‡Ø±Ø§Ù„Ø§ÙŠØª', en: 'Welcome to KahraLight' }
            }
        };

        const i18n = {
            ar: { all_products: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª', categories:'Ø§Ù„ÙØ¦Ø§Øª', about:'Ù…Ù† Ù†Ø­Ù†', links:'Ø±ÙˆØ§Ø¨Ø·', home:'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', contact:'Ø§ØªØµÙ„ Ø¨Ù†Ø§', report:'Ø§Ø¨Ù„Ø§Øº', send:'Ø§Ø±Ø³Ø§Ù„', back:'Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ØªØ¬Ø±', order_form:'Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨', qty:'Ø§Ù„ÙƒÙ…ÙŠØ©', color:'Ø§Ù„Ù„ÙˆÙ†', name:'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„', phone:'Ø§Ù„Ù‡Ø§ØªÙ', country:'Ø§Ù„Ø¨Ù„Ø¯', address:'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†', buy_now:'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨' },
            fr: { all_products: 'Tous les produits', categories:'CatÃ©gories', about:'Ã€ propos', links:'Liens', home:'Accueil', contact:'Contact', report:'Signaler', send:'Envoyer', back:'Retour', order_form:'Bon de commande', qty:'QuantitÃ©', color:'Couleur', name:'Nom complet', phone:'TÃ©lÃ©phone', country:'Pays', address:'Adresse', buy_now:'Confirmer' },
            en: { all_products: 'All Products', categories:'Categories', about:'About', links:'Links', home:'Home', contact:'Contact', report:'Report', send:'Send', back:'Back to Store', order_form:'Order Form', qty:'Qty', color:'Color', name:'Full Name', phone:'Phone', country:'Country', address:'Address', buy_now:'Confirm Order' },
            es: { all_products: 'Todos los productos', categories:'CategorÃ­as', about:'Sobre nosotros', links:'Enlaces', home:'Inicio', contact:'Contacto', report:'Reportar', send:'Enviar', back:'Volver', order_form:'Pedido', qty:'Cant', color:'Color', name:'Nombre', phone:'TelÃ©fono', country:'PaÃ­s', address:'DirecciÃ³n', buy_now:'Confirmar' }
        };

        // --- CORE FUNCTIONS ---
        window.changeLang = (l) => {
            state.lang = l;
            document.documentElement.lang = l;
            document.documentElement.dir = (l==='ar') ? 'rtl' : 'ltr';
            state.currency = (l==='ar') ? 'DA' : 'â‚¬';
            
            // UI Translation
            document.querySelectorAll('[data-key]').forEach(el => {
                if(i18n[l][el.dataset.key]) el.innerText = i18n[l][el.dataset.key];
            });

            // Ticker
            const t = document.getElementById('ticker-text');
            t.innerText = state.settings.ticker[l] || state.settings.ticker['en'];
            t.style.animation = (l==='ar') ? 'ticker-ltr 20s linear infinite' : 'ticker-rtl 20s linear infinite';
            
            renderGrid();
        };

        window.goHome = () => {
            document.querySelectorAll('.page-view').forEach(e => e.classList.remove('active'));
            document.getElementById('view-home').classList.add('active');
            window.history.pushState({}, '', '/');
            window.scrollTo(0,0);
        };

        window.renderGrid = (filter=null) => {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = '';
            let list = state.products;
            if(filter) list = list.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()));

            list.forEach(p => {
                const pr = (state.lang==='ar') ? p.price_da : p.price_eu;
                grid.innerHTML += `
                    <div class="product-card" onclick="openProduct('${p.id}')">
                        <div class="p-img-box"><img src="${p.imgs[0]}" class="p-img"></div>
                        <div class="p-info">
                            <div class="p-cat">${p.cat}</div>
                            <div class="p-title">${p.name}</div>
                            <div class="p-price">${pr} ${state.currency}</div>
                        </div>
                    </div>`;
            });
        };

        window.openProduct = (id) => {
            const p = state.products.find(x => x.id == id);
            if(!p) return;
            
            // Update URL
            window.history.pushState({}, '', `/product/${p.name.replace(/\s+/g,'-')}`);

            // Switch View
            document.querySelectorAll('.page-view').forEach(e => e.classList.remove('active'));
            document.getElementById('view-product').classList.add('active');
            window.scrollTo(0,0);

            // Populate Data
            document.getElementById('dt-main-img').src = p.imgs[0];
            document.getElementById('dt-thumbs').innerHTML = p.imgs.map(s=>`<img src="${s}" class="thumb" onclick="document.getElementById('dt-main-img').src='${s}'">`).join('');
            document.getElementById('dt-cat').innerText = p.cat;
            document.getElementById('dt-title').innerText = p.name;
            document.getElementById('dt-price').innerText = (state.lang==='ar' ? p.price_da : p.price_eu) + ' ' + state.currency;
            document.getElementById('dt-desc').innerText = p.desc;
            
            const colSel = document.getElementById('ord-color');
            colSel.innerHTML = '';
            if(p.colors) p.colors.forEach(c => colSel.innerHTML += `<option>${c}</option>`);

            window.currPid = id;
        };

        window.placeOrder = async () => {
            const p = state.products.find(x => x.id == window.currPid);
            const order = {
                product: p.name,
                price: (state.lang==='ar') ? p.price_da : p.price_eu,
                currency: state.currency,
                qty: document.getElementById('ord-qty').value,
                color: document.getElementById('ord-color').value,
                customer: document.getElementById('ord-name').value,
                phone: document.getElementById('ord-phone').value,
                country: document.getElementById('ord-country').value,
                address: document.getElementById('ord-addr').value,
                date: new Date().toLocaleDateString()
            };

            if(!order.customer || !order.phone) return alert('Please fill name and phone');

            if(db) await addDoc(collection(db, 'orders'), order);
            else { state.orders.unshift(order); updateAdmin(); }

            document.getElementById('success-msg').style.display='flex';
            setTimeout(() => {
                document.getElementById('success-msg').style.display='none';
                goHome();
            }, 2500);
        };

        // --- ADMIN ---
        window.openAdminLogin = () => document.getElementById('login-modal').style.display='flex';
        window.doLogin = () => {
            if(document.getElementById('u-name').value === 'admin' && document.getElementById('u-pass').value === 'abobob123') {
                document.getElementById('login-modal').style.display='none';
                document.querySelectorAll('.page-view').forEach(e => e.classList.remove('active'));
                document.getElementById('view-admin').style.display='block';
                updateAdmin();
            } else document.getElementById('log-err').style.display='block';
        };

        window.admTab = (t) => {
             document.getElementById('tab-prods').style.display = t==='prods'?'block':'none';
             document.getElementById('tab-orders').style.display = t==='orders'?'block':'none';
             document.getElementById('tab-settings').style.display = t==='settings'?'block':'none';
        };

        // Image Handling (File or URL)
        window.previewFile = () => {
            const file = document.getElementById('p-img-file').files[0];
            if(file){
                const reader = new FileReader();
                reader.onload = (e) => { document.getElementById('p-img-url').value = e.target.result; }; // Base64 for instant demo
                reader.readAsDataURL(file);
            }
        };

        window.saveProduct = async () => {
            const id = document.getElementById('edit-id').value || Date.now().toString();
            // Handle Images
            let imgVal = document.getElementById('p-img-url').value;
            let imgs = imgVal ? [imgVal] : ['https://via.placeholder.com/400'];

            const data = {
                id: id,
                name: document.getElementById('p-name').value,
                cat: document.getElementById('p-cat').value,
                price_da: Number(document.getElementById('p-price-da').value),
                price_eu: Number(document.getElementById('p-price-eu').value),
                desc: document.getElementById('p-desc').value,
                colors: document.getElementById('p-colors').value.split(','),
                imgs: imgs
            };

            if(db) await setDoc(doc(db, 'products', id), data);
            else {
                const idx = state.products.findIndex(x=>x.id==id);
                if(idx>-1) state.products[idx] = data; else state.products.push(data);
                renderGrid(); updateAdmin();
            }
            alert('Saved!');
            // clear inputs...
        };

        window.addSlide = () => {
            const u = document.getElementById('slide-url').value;
            if(u) { state.settings.slider.push(u); saveSettings(); }
        };

        window.saveSettings = async () => {
            const s = {
                theme: document.getElementById('set-theme').value,
                slider: state.settings.slider,
                ticker: { ar: document.getElementById('tick-ar').value || state.settings.ticker.ar, en: document.getElementById('tick-en').value || state.settings.ticker.en }
            };
            if(db) await setDoc(doc(db,'settings','main'), s);
            else { state.settings = s; applySettings(); }
            alert('Settings Updated');
        };

        window.importCSV = () => {
             // Basic CSV parser simulation
             const f = document.getElementById('csv-file').files[0];
             if(f) {
                 alert('CSV Uploaded & Parsed (Simulated)'); 
                 // Logic would go here
             }
        };

        function updateAdmin() {
            document.getElementById('adm-orders').innerText = state.orders.length;
            const rev = state.orders.reduce((a,b) => a + (b.currency=='DA'?b.price:b.price*220), 0);
            document.getElementById('adm-rev').innerText = rev + ' DA';
            
            // Prod List
            document.getElementById('adm-prod-list').innerHTML = state.products.map(p => 
                `<div style="padding:10px; border-bottom:1px solid #ddd; display:flex; justify-content:space-between;"><b>${p.name}</b> <button onclick="editProd('${p.id}')">Edit</button></div>`
            ).join('');
            
            // Orders
            document.getElementById('adm-order-rows').innerHTML = state.orders.map(o => 
                `<tr><td>${o.date}</td><td>${o.customer}</td><td>${o.product}</td><td>${o.price} ${o.currency}</td></tr>`
            ).join('');
        }
        
        window.editProd = (id) => {
            const p = state.products.find(x=>x.id==id);
            document.getElementById('edit-id').value = p.id;
            document.getElementById('p-name').value = p.name;
            document.getElementById('p-cat').value = p.cat;
            document.getElementById('p-price-da').value = p.price_da;
            document.getElementById('p-price-eu').value = p.price_eu;
            document.getElementById('p-desc').value = p.desc;
            document.getElementById('p-img-url').value = p.imgs[0];
        };

        function applySettings() {
            document.body.className = state.settings.theme;
            // Slider Logic
            const sl = document.getElementById('home-slider');
            sl.innerHTML = state.settings.slider.map((s,i)=>`<img src="${s}" class="slide ${i==0?'active':''}">`).join('');
            
            if(window.slInt) clearInterval(window.slInt);
            let si = 0;
            window.slInt = setInterval(() => {
                const els = document.querySelectorAll('.slide');
                if(els.length){
                    els[si].classList.remove('active');
                    si = (si+1)%els.length;
                    els[si].classList.add('active');
                }
            }, 2000); // 2 Seconds
            
            changeLang(state.lang);
        }

        // --- INIT ---
        if(db) {
            onSnapshot(collection(db,'products'), s=>{ let t=[]; s.forEach(d=>t.push(d.data())); state.products=t; renderGrid(); 
                // Cats
                const cats=[...new Set(t.map(x=>x.cat))];
                document.getElementById('cat-list').innerHTML=cats.map(c=>`<div class="cat-link" onclick="renderGrid('${c}')">${c}</div>`).join('');
            });
            onSnapshot(doc(db,'settings','main'), d=>{ if(d.exists()){ state.settings=d.data(); applySettings(); }});
        } else {
            // Local Data for Demo
            state.products = [
                {id:'1', name:'Smart Bulb RGB', cat:'Lighting', price_da:1200, price_eu:6, desc:'WiFi Control', colors:['White'], imgs:['https://images.unsplash.com/photo-1550989460-0adf9ea622e2?q=80&w=600']},
                {id:'2', name:'Crystal Chandelier', cat:'Decor', price_da:25000, price_eu:120, desc:'Luxury', colors:['Gold'], imgs:['https://images.unsplash.com/photo-1579725942955-4d8377f853b4?q=80&w=600']}
            ];
            renderGrid();
            document.getElementById('cat-list').innerHTML = `<div class="cat-link" onclick="renderGrid()">All</div><div class="cat-link" onclick="renderGrid('Lighting')">Lighting</div>`;
            applySettings();
        }

    </script>
</body>
</html>
